<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Tasa BCV en Línea (Railway Deploy)</title>
    <style>
    body { font-family: Arial, sans-serif; background: #e5eaf7; }
    .container { background: white; margin: 40px auto; max-width: 400px; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px #0001 }
    button { background:#2186eb; color:white; border:none; padding: 8px 12px; cursor:pointer; border-radius: 4px;}
    </style>
</head>
<body>
    <div class="container">
        <h2>Tasa oficial BCV:</h2>
        <p id="tasa">Cargando tasa...</p>
        <small id="fecha"></small><br><br>
        <button onclick="actualizarTasa()">Actualizar tasa desde BCV</button>
    </div>
    <script>
    function cargarTasa() {
        fetch("/api/tasa_bcv")
        .then(r => r.json())
        .then(d => {
            document.getElementById("tasa").textContent = d.tasa ? (d.tasa + " Bs/USD") : "No disponible";
            document.getElementById("fecha").textContent = d.fecha ? "Fecha: " + d.fecha : "";
        })
        .catch(()=>{document.getElementById("tasa").textContent = "Error de consulta."});
    }
    function actualizarTasa() {
        fetch("/api/tasa_bcv/actualizar", {method: "POST"})
        .then(r => r.json())
        .then(d => {
            if (d.ok) {
                cargarTasa();
                alert("¡Tasa actualizada desde BCV!");
            } else {
                alert("No se pudo obtener la tasa de BCV");
            }
        })
        .catch(()=>alert("Error actualizando tasa."));
    }
    cargarTasa();
    </script>
</body>
</html>